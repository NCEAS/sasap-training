<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Open Science for Salmon</title>
  <meta name="description" content="Practical open science approaches to salmon data management, analysis, and synthesis">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Open Science for Salmon" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Practical open science approaches to salmon data management, analysis, and synthesis" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Open Science for Salmon" />
  
  <meta name="twitter:description" content="Practical open science approaches to salmon data management, analysis, and synthesis" />
  

<meta name="author" content="Authors Go Here">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="introduction.html">
<link rel="next" href="batch-reformatting.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Open Science for Salmon</a></li>
<li><a href="/sasap-training/">← Back to main website</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="reformatting.html"><a href="reformatting.html"><i class="fa fa-check"></i><b>3</b> Reformatting</a></li>
<li class="chapter" data-level="4" data-path="batch-reformatting.html"><a href="batch-reformatting.html"><i class="fa fa-check"></i><b>4</b> Batch Reformatting</a></li>
<li class="chapter" data-level="5" data-path="merging.html"><a href="merging.html"><i class="fa fa-check"></i><b>5</b> Merging</a></li>
<li class="chapter" data-level="6" data-path="quality-assurance.html"><a href="quality-assurance.html"><i class="fa fa-check"></i><b>6</b> Quality Assurance</a></li>
<li class="chapter" data-level="7" data-path="rstudio-and-gitgithub-setup.html"><a href="rstudio-and-gitgithub-setup.html"><i class="fa fa-check"></i><b>7</b> RStudio and Git/GitHub Setup</a></li>
<li class="chapter" data-level="8" data-path="version-control-with-git-and-github.html"><a href="version-control-with-git-and-github.html"><i class="fa fa-check"></i><b>8</b> Version Control With Git and GitHub</a></li>
<li class="chapter" data-level="9" data-path="data-modeling-tidy-data.html"><a href="data-modeling-tidy-data.html"><i class="fa fa-check"></i><b>9</b> Data Modeling &amp; Tidy Data</a></li>
<li class="chapter" data-level="10" data-path="data-cleaning-and-manipulation.html"><a href="data-cleaning-and-manipulation.html"><i class="fa fa-check"></i><b>10</b> Data Cleaning and Manipulation</a><ul>
<li class="chapter" data-level="10.1" data-path="data-cleaning-and-manipulation.html"><a href="data-cleaning-and-manipulation.html#outline-tbd"><i class="fa fa-check"></i><b>10.1</b> Outline (TBD)</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="hands-on-clean-and-integrate-datasets.html"><a href="hands-on-clean-and-integrate-datasets.html"><i class="fa fa-check"></i><b>11</b> Hands On: Clean and Integrate Datasets</a></li>
<li class="chapter" data-level="12" data-path="publication-graphics-with-ggplot2.html"><a href="publication-graphics-with-ggplot2.html"><i class="fa fa-check"></i><b>12</b> Publication Graphics with ggplot2</a></li>
<li class="chapter" data-level="13" data-path="data-documentation-and-publishing.html"><a href="data-documentation-and-publishing.html"><i class="fa fa-check"></i><b>13</b> Data Documentation and Publishing</a></li>
<li class="chapter" data-level="14" data-path="publishing-analyses-to-the-web.html"><a href="publishing-analyses-to-the-web.html"><i class="fa fa-check"></i><b>14</b> Publishing Analyses to the Web</a></li>
<li class="chapter" data-level="15" data-path="literate-analysis-with-rmarkdown.html"><a href="literate-analysis-with-rmarkdown.html"><i class="fa fa-check"></i><b>15</b> Literate Analysis with RMarkdown</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Open Science for Salmon</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reformatting" class="section level1">
<h1><span class="header-section-number">3</span> Reformatting</h1>
<p>First we need to change the brood table column names so that they are in a consistent format. Here we show an example of how one of our source tables (Coghill Lake, from above) is reformatted. Prior to diving into reformatting, it is good to have an idea of what columns will be necessary in your merged data table. To identify different stocks, certainly a column will be needed for the stock name (usually a river name) and the species. If you wish to analyze across different regions or areas, you may want to have a column for region as well. Of course you will also need columns for brood year and all of the possible age classes you might encounter. A quality flag indicating whether data should be used in analysis or not based on set critera is also useful. Finally, it is also a good idea to have a unique identifier for each brood table that goes into the merged data table so that you can easily add data by stock, or summarize data by stock. With that in mind, we will be reformatting all of the brood tables so they have the following column names:</p>
<pre><code>&#39;Stock.ID&#39;, &#39;Species&#39;, &#39;Stock&#39;,&#39;Region&#39;,&#39;Sub.Region&#39;,&#39;UseFlag&#39;,
&#39;BroodYear&#39;,&#39;TotalEscapement&#39;,
&#39;R0.1&#39;,&#39;R0.2&#39;, &#39;R0.3&#39;,&#39;R0.4&#39;,   &#39;R0.5&#39;,
&#39;R1.1&#39;,&#39;R1.2&#39;,&#39;R1.3&#39;,&#39;R1.4&#39;,&#39;R1.5&#39;, 
&#39;R2.1&#39;,&#39;R2.2&#39;,&#39;R2.3&#39;,&#39;R2.4&#39;,&#39;R2.5&#39;,
&#39;R3.1&#39;,&#39;R3.2&#39;,&#39;R3.3&#39;,&#39;R3.4&#39;,
&#39;R4.1&#39;,&#39;R4.2&#39; ,&#39;R4.3&#39;</code></pre>
<p>First we need to load any packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readxl)
<span class="kw">library</span>(plyr)</code></pre></div>
<p>Now read in the file, skipping the first 6 lines before the true header row on line 7, and check the column names</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&#39;data/112_COGHILL_BROOD_TABLE.xls&#39;</span>, <span class="dt">skip =</span> <span class="dv">6</span>)
<span class="kw">colnames</span>(b)</code></pre></div>
<pre><code>##  [1] &quot;Year&quot;           &quot;Escpmt.&quot;        &quot;Year__1&quot;        &quot;1.1&quot;           
##  [5] &quot;0.2&quot;            &quot;Year__2&quot;        &quot;0.3&quot;            &quot;Aged 1.2&quot;      
##  [9] &quot;Aged 2.1&quot;       &quot;Year__3&quot;        &quot;Aged 1.3&quot;       &quot;Aged 2.2&quot;      
## [13] &quot;Year__4&quot;        &quot;Aged 1.4&quot;       &quot;Aged 2.3&quot;       &quot;Year__5&quot;       
## [17] &quot;Aged 2.4&quot;       &quot;Return&quot;         &quot;Year__6&quot;        &quot;Return__1&quot;     
## [21] &quot;Return/spawner&quot;</code></pre>
<p>There are definitely some redundant and confusing columns here that we need to remove, and some we need to add according to the list above. First we remove the columns we don’t want - namely all of the return years, the total return, and recruits/spawner. Note that we can always calculate these columns again later from the rest of the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#delete columns by column name</span>
b<span class="op">$</span>Year__<span class="dv">1</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span>Year__<span class="dv">2</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span>Year__<span class="dv">3</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span>Year__<span class="dv">4</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span>Year__<span class="dv">5</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span>Year__<span class="dv">6</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span>Return &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span>Return__<span class="dv">1</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span><span class="st">`</span><span class="dt">Return/spawner</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="ot">NULL</span></code></pre></div>
<p>Now we need to fill in the information that is missing by adding columns: <code>'Stock.ID', 'Species', 'Stock','Region','Sub.Region','UseFlag'</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#add stock information columns</span>
b<span class="op">$</span>Stock.ID &lt;-<span class="st"> </span><span class="dv">139</span> <span class="co">#preassigned Stock.ID</span>
b<span class="op">$</span>Species &lt;-<span class="st"> &#39;Sockeye&#39;</span>
b<span class="op">$</span>Stock &lt;-<span class="st"> &#39;Coghill&#39;</span>
b<span class="op">$</span>Region &lt;-<span class="st"> &#39;PWS&#39;</span>
b<span class="op">$</span>Sub.Region &lt;-<span class="st"> &#39;PWS&#39;</span>
b<span class="op">$</span>UseFlag &lt;-<span class="st"> </span><span class="dv">1</span></code></pre></div>
<p>Note that since we have no reason to suspect any data are not up to quality standards yet, we fill the <code>UseFlag</code> columns with 1s.</p>
<p>Let’s do another check on column names now.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(b)</code></pre></div>
<pre><code>##  [1] &quot;Year&quot;       &quot;Escpmt.&quot;    &quot;1.1&quot;        &quot;0.2&quot;        &quot;0.3&quot;       
##  [6] &quot;Aged 1.2&quot;   &quot;Aged 2.1&quot;   &quot;Aged 1.3&quot;   &quot;Aged 2.2&quot;   &quot;Aged 1.4&quot;  
## [11] &quot;Aged 2.3&quot;   &quot;Aged 2.4&quot;   &quot;Stock.ID&quot;   &quot;Species&quot;    &quot;Stock&quot;     
## [16] &quot;Region&quot;     &quot;Sub.Region&quot; &quot;UseFlag&quot;</code></pre>
<p>Getting close, but these are not quite in the format that we decided on so we will rename them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(b) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;BroodYear&quot;</span>, <span class="st">&quot;TotalEscapement&quot;</span>,<span class="st">&quot;R1.1&quot;</span>,<span class="st">&quot;R0.2&quot;</span>,<span class="st">&quot;R0.3&quot;</span>,<span class="st">&quot;R1.2&quot;</span>,<span class="st">&quot;R2.1&quot;</span>,<span class="st">&quot;R1.3&quot;</span>,<span class="st">&quot;R2.2&quot;</span>,  
<span class="st">&quot;R1.4&quot;</span>,<span class="st">&quot;R2.3&quot;</span>,<span class="st">&quot;R2.4&quot;</span>,<span class="st">&quot;Stock.ID&quot;</span>,<span class="st">&quot;Species&quot;</span>,<span class="st">&#39;Stock&#39;</span>,<span class="st">&quot;Region&quot;</span>,<span class="st">&quot;Sub.Region&quot;</span>,<span class="st">&quot;UseFlag&quot;</span>)</code></pre></div>
<p>Finally, you may want to reorder the columns into something more intuitive.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b &lt;-<span class="st"> </span>b[, <span class="kw">c</span>(<span class="st">&#39;Stock.ID&#39;</span>, <span class="st">&#39;Species&#39;</span>, <span class="st">&#39;Stock&#39;</span>,<span class="st">&#39;Region&#39;</span>,<span class="st">&#39;Sub.Region&#39;</span>, <span class="st">&#39;UseFlag&#39;</span>,
           <span class="st">&#39;BroodYear&#39;</span>,<span class="st">&#39;TotalEscapement&#39;</span>,<span class="st">&#39;R0.2&#39;</span>, <span class="st">&#39;R0.3&#39;</span>,
           <span class="st">&#39;R1.1&#39;</span>,<span class="st">&#39;R1.2&#39;</span>,<span class="st">&#39;R1.3&#39;</span>,<span class="st">&#39;R1.4&#39;</span>, 
           <span class="st">&#39;R2.1&#39;</span>,<span class="st">&#39;R2.2&#39;</span>,<span class="st">&#39;R2.3&#39;</span>,<span class="st">&#39;R2.4&#39;</span>)]</code></pre></div>
<p>And very lastly, write the file to a new directory where all of the individually reformatted brood tables will be kept.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.csv</span>(b, <span class="st">&#39;Coghill_sockeye.csv&#39;</span>, <span class="dt">row.names =</span> F)</code></pre></div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="batch-reformatting.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-brood-table-integration.Rmd",
"text": "Edit"
},
"download": ["open-science-for-salmon.pdf", "open-science-for-salmon.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
