<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Open Science for Salmon</title>
  <meta name="description" content="Practical open science approaches to salmon data management, analysis, and synthesis">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Open Science for Salmon" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Practical open science approaches to salmon data management, analysis, and synthesis" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Open Science for Salmon" />
  
  <meta name="twitter:description" content="Practical open science approaches to salmon data management, analysis, and synthesis" />
  

<meta name="author" content="Authors Go Here">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="rstudio-and-gitgithub-setup.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Open Science for Salmon</a></li>
<li><a href="/sasap-training/">← Back to main website</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="title.html"><a href="title.html"><i class="fa fa-check"></i><b>2</b> title</a><ul>
<li class="chapter" data-level="2.0.1" data-path="title.html"><a href="title.html#introduction"><i class="fa fa-check"></i><b>2.0.1</b> Introduction</a></li>
<li class="chapter" data-level="2.0.2" data-path="title.html"><a href="title.html#reformatting"><i class="fa fa-check"></i><b>2.0.2</b> Reformatting</a></li>
<li class="chapter" data-level="2.0.3" data-path="title.html"><a href="title.html#batch-reformatting"><i class="fa fa-check"></i><b>2.0.3</b> Batch Reformatting</a></li>
<li class="chapter" data-level="2.0.4" data-path="title.html"><a href="title.html#merging"><i class="fa fa-check"></i><b>2.0.4</b> Merging</a></li>
<li class="chapter" data-level="2.0.5" data-path="title.html"><a href="title.html#quality-assurance"><i class="fa fa-check"></i><b>2.0.5</b> Quality Assurance</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="rstudio-and-gitgithub-setup.html"><a href="rstudio-and-gitgithub-setup.html"><i class="fa fa-check"></i><b>3</b> RStudio and Git/GitHub Setup</a></li>
<li class="chapter" data-level="4" data-path="version-control-with-git-and-github.html"><a href="version-control-with-git-and-github.html"><i class="fa fa-check"></i><b>4</b> Version Control With Git and GitHub</a></li>
<li class="chapter" data-level="5" data-path="data-modeling-tidy-data.html"><a href="data-modeling-tidy-data.html"><i class="fa fa-check"></i><b>5</b> Data Modeling &amp; Tidy Data</a></li>
<li class="chapter" data-level="6" data-path="data-cleaning-and-manipulation.html"><a href="data-cleaning-and-manipulation.html"><i class="fa fa-check"></i><b>6</b> Data Cleaning and Manipulation</a><ul>
<li class="chapter" data-level="6.1" data-path="data-cleaning-and-manipulation.html"><a href="data-cleaning-and-manipulation.html#outline-tbd"><i class="fa fa-check"></i><b>6.1</b> Outline (TBD)</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="hands-on-clean-and-integrate-datasets.html"><a href="hands-on-clean-and-integrate-datasets.html"><i class="fa fa-check"></i><b>7</b> Hands On: Clean and Integrate Datasets</a></li>
<li class="chapter" data-level="8" data-path="publication-graphics-with-ggplot2.html"><a href="publication-graphics-with-ggplot2.html"><i class="fa fa-check"></i><b>8</b> Publication Graphics with ggplot2</a></li>
<li class="chapter" data-level="9" data-path="data-documentation-and-publishing.html"><a href="data-documentation-and-publishing.html"><i class="fa fa-check"></i><b>9</b> Data Documentation and Publishing</a></li>
<li class="chapter" data-level="10" data-path="publishing-analyses-to-the-web.html"><a href="publishing-analyses-to-the-web.html"><i class="fa fa-check"></i><b>10</b> Publishing Analyses to the Web</a></li>
<li class="chapter" data-level="11" data-path="literate-analysis-with-rmarkdown.html"><a href="literate-analysis-with-rmarkdown.html"><i class="fa fa-check"></i><b>11</b> Literate Analysis with RMarkdown</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Open Science for Salmon</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="title" class="section level1">
<h1><span class="header-section-number">2</span> title</h1>
<div id="introduction" class="section level3">
<h3><span class="header-section-number">2.0.1</span> Introduction</h3>
<p>Brood tables, also called run reconstructions, utilize annual estimates of the total run (commercial catch plus escapement), and samples of ages, to determine the number of recruits per age class. These data are useful for salmon biologists to understand salmon productivity and salmon life histories.</p>
<p>These data can come in a number of different formats, but generally have rows of individual years, and columns with the total escapement and age classes, such as this:</p>
<div class="figure">
<img src="images/GoodnewsHeader.png" />

</div>
<p>Sometimes other columns are included, such as return years in this example:</p>
<div class="figure">
<img src="images/CoghillHeader.png" />

</div>
<p>If you are interested in analysing trends across multiple stocks, the many different ways brood tables can be presented creates a formatting challenge. In this exercise we will intoduce some ways to reformat, merge, and reshape these brood tables.</p>
</div>
<div id="reformatting" class="section level3">
<h3><span class="header-section-number">2.0.2</span> Reformatting</h3>
<p>First we need to change the brood table column names so that they are in a consistent format. Here we show an example of how one of our source tables (Coghill Lake, from above) is reformatted. Prior to diving into reformatting, it is good to have an idea of what columns will be necessary in your merged data table. To identify different stocks, certainly a column will be needed for the stock name (usually a river name) and the species. If you wish to analyze across different regions or areas, you may want to have a column for region as well. Of course you will also need columns for brood year and all of the possible age classes you might encounter. A quality flag indicating whether data should be used in analysis or not based on set critera is also useful. Finally, it is also a good idea to have a unique identifier for each brood table that goes into the merged data table so that you can easily add data by stock, or summarize data by stock. With that in mind, we will be reformatting all of the brood tables so they have the following column names:</p>
<pre><code>&#39;Stock.ID&#39;, &#39;Species&#39;, &#39;Stock&#39;,&#39;Region&#39;,&#39;Sub.Region&#39;,&#39;UseFlag&#39;,
&#39;BroodYear&#39;,&#39;TotalEscapement&#39;,
&#39;R0.1&#39;,&#39;R0.2&#39;, &#39;R0.3&#39;,&#39;R0.4&#39;,   &#39;R0.5&#39;,
&#39;R1.1&#39;,&#39;R1.2&#39;,&#39;R1.3&#39;,&#39;R1.4&#39;,&#39;R1.5&#39;, 
&#39;R2.1&#39;,&#39;R2.2&#39;,&#39;R2.3&#39;,&#39;R2.4&#39;,&#39;R2.5&#39;,
&#39;R3.1&#39;,&#39;R3.2&#39;,&#39;R3.3&#39;,&#39;R3.4&#39;,
&#39;R4.1&#39;,&#39;R4.2&#39; ,&#39;R4.3&#39;</code></pre>
<p>First we need to load any packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readxl)
<span class="kw">library</span>(plyr)</code></pre></div>
<p>Now read in the file, skipping the first 6 lines before the true header row on line 7, and check the column names</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&#39;data/112_COGHILL_BROOD_TABLE.xls&#39;</span>, <span class="dt">skip =</span> <span class="dv">6</span>)
<span class="kw">colnames</span>(b)</code></pre></div>
<pre><code>##  [1] &quot;Year&quot;           &quot;Escpmt.&quot;        &quot;Year__1&quot;        &quot;1.1&quot;           
##  [5] &quot;0.2&quot;            &quot;Year__2&quot;        &quot;0.3&quot;            &quot;Aged 1.2&quot;      
##  [9] &quot;Aged 2.1&quot;       &quot;Year__3&quot;        &quot;Aged 1.3&quot;       &quot;Aged 2.2&quot;      
## [13] &quot;Year__4&quot;        &quot;Aged 1.4&quot;       &quot;Aged 2.3&quot;       &quot;Year__5&quot;       
## [17] &quot;Aged 2.4&quot;       &quot;Return&quot;         &quot;Year__6&quot;        &quot;Return__1&quot;     
## [21] &quot;Return/spawner&quot;</code></pre>
<p>There are definitely some redundant and confusing columns here that we need to remove, and some we need to add according to the list above. First we remove the columns we don’t want - namely all of the return years, the total return, and recruits/spawner. Note that we can always calculate these columns again later from the rest of the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#delete columns by column name</span>
b<span class="op">$</span>Year__<span class="dv">1</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span>Year__<span class="dv">2</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span>Year__<span class="dv">3</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span>Year__<span class="dv">4</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span>Year__<span class="dv">5</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span>Year__<span class="dv">6</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span>Return &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span>Return__<span class="dv">1</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
b<span class="op">$</span><span class="st">`</span><span class="dt">Return/spawner</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="ot">NULL</span></code></pre></div>
<p>Now we need to fill in the information that is missing by adding columns: <code>'Stock.ID', 'Species', 'Stock','Region','Sub.Region','UseFlag'</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#add stock information columns</span>
b<span class="op">$</span>Stock.ID &lt;-<span class="st"> </span><span class="dv">139</span> <span class="co">#preassigned Stock.ID</span>
b<span class="op">$</span>Species &lt;-<span class="st"> &#39;Sockeye&#39;</span>
b<span class="op">$</span>Stock &lt;-<span class="st"> &#39;Coghill&#39;</span>
b<span class="op">$</span>Region &lt;-<span class="st"> &#39;PWS&#39;</span>
b<span class="op">$</span>Sub.Region &lt;-<span class="st"> &#39;PWS&#39;</span>
b<span class="op">$</span>UseFlag &lt;-<span class="st"> </span><span class="dv">1</span></code></pre></div>
<p>Note that since we have no reason to suspect any data are not up to quality standards yet, we fill the <code>UseFlag</code> columns with 1s.</p>
<p>Let’s do another check on column names now.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(b)</code></pre></div>
<pre><code>##  [1] &quot;Year&quot;       &quot;Escpmt.&quot;    &quot;1.1&quot;        &quot;0.2&quot;        &quot;0.3&quot;       
##  [6] &quot;Aged 1.2&quot;   &quot;Aged 2.1&quot;   &quot;Aged 1.3&quot;   &quot;Aged 2.2&quot;   &quot;Aged 1.4&quot;  
## [11] &quot;Aged 2.3&quot;   &quot;Aged 2.4&quot;   &quot;Stock.ID&quot;   &quot;Species&quot;    &quot;Stock&quot;     
## [16] &quot;Region&quot;     &quot;Sub.Region&quot; &quot;UseFlag&quot;</code></pre>
<p>Getting close, but these are not quite in the format that we decided on so we will rename them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(b) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;BroodYear&quot;</span>, <span class="st">&quot;TotalEscapement&quot;</span>,<span class="st">&quot;R1.1&quot;</span>,<span class="st">&quot;R0.2&quot;</span>,<span class="st">&quot;R0.3&quot;</span>,<span class="st">&quot;R1.2&quot;</span>,<span class="st">&quot;R2.1&quot;</span>,<span class="st">&quot;R1.3&quot;</span>,<span class="st">&quot;R2.2&quot;</span>,  
<span class="st">&quot;R1.4&quot;</span>,<span class="st">&quot;R2.3&quot;</span>,<span class="st">&quot;R2.4&quot;</span>,<span class="st">&quot;Stock.ID&quot;</span>,<span class="st">&quot;Species&quot;</span>,<span class="st">&#39;Stock&#39;</span>,<span class="st">&quot;Region&quot;</span>,<span class="st">&quot;Sub.Region&quot;</span>,<span class="st">&quot;UseFlag&quot;</span>)</code></pre></div>
<p>Finally, you may want to reorder the columns into something more intuitive.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b &lt;-<span class="st"> </span>b[, <span class="kw">c</span>(<span class="st">&#39;Stock.ID&#39;</span>, <span class="st">&#39;Species&#39;</span>, <span class="st">&#39;Stock&#39;</span>,<span class="st">&#39;Region&#39;</span>,<span class="st">&#39;Sub.Region&#39;</span>, <span class="st">&#39;UseFlag&#39;</span>,
           <span class="st">&#39;BroodYear&#39;</span>,<span class="st">&#39;TotalEscapement&#39;</span>,<span class="st">&#39;R0.2&#39;</span>, <span class="st">&#39;R0.3&#39;</span>,
           <span class="st">&#39;R1.1&#39;</span>,<span class="st">&#39;R1.2&#39;</span>,<span class="st">&#39;R1.3&#39;</span>,<span class="st">&#39;R1.4&#39;</span>, 
           <span class="st">&#39;R2.1&#39;</span>,<span class="st">&#39;R2.2&#39;</span>,<span class="st">&#39;R2.3&#39;</span>,<span class="st">&#39;R2.4&#39;</span>)]</code></pre></div>
<p>And very lastly, write the file to a new directory where all of the individually reformatted brood tables will be kept.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.csv</span>(b, <span class="st">&#39;Coghill_sockeye.csv&#39;</span>, <span class="dt">row.names =</span> F)</code></pre></div>
</div>
<div id="batch-reformatting" class="section level3">
<h3><span class="header-section-number">2.0.3</span> Batch Reformatting</h3>
<p>Once a reformatting script has been written for all of the data files that are going to be incorporated, we can write another script that will run all of those scripts at once. In this case, I use a nicely written function from <a href="https://stackoverflow.com/a/20083589">stack overflow</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sourceEntireFolder &lt;-<span class="st"> </span><span class="cf">function</span>(folderName, <span class="dt">verbose=</span><span class="ot">FALSE</span>, <span class="dt">showWarnings=</span><span class="ot">TRUE</span>) { 
    files &lt;-<span class="st"> </span><span class="kw">list.files</span>(folderName, <span class="dt">full.names=</span><span class="ot">TRUE</span>)
    
    <span class="co"># Grab only R files</span>
    files &lt;-<span class="st"> </span>files[ <span class="kw">grepl</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">.[rR]$&quot;</span>, files) ]
    
    <span class="cf">if</span> (<span class="op">!</span><span class="kw">length</span>(files) <span class="op">&amp;&amp;</span><span class="st"> </span>showWarnings)
        <span class="kw">warning</span>(<span class="st">&quot;No R files in &quot;</span>, folderName)
    
    <span class="cf">for</span> (f <span class="cf">in</span> files) {
        <span class="cf">if</span> (verbose)
            <span class="kw">cat</span>(<span class="st">&quot;sourcing: &quot;</span>, f, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
        <span class="kw">try</span>(<span class="kw">source</span>(f, <span class="dt">local=</span><span class="ot">FALSE</span>, <span class="dt">echo=</span><span class="ot">FALSE</span>), <span class="dt">silent=</span><span class="op">!</span>verbose)
    }
    <span class="kw">return</span>(<span class="kw">invisible</span>(<span class="ot">NULL</span>))
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">t &lt;-<span class="st"> </span><span class="kw">sourceEntireFolder</span>(<span class="st">&#39;data/data_formatting_scripts/&#39;</span>, <span class="dt">verbose =</span> T)</code></pre></div>
</div>
<div id="merging" class="section level3">
<h3><span class="header-section-number">2.0.4</span> Merging</h3>
<p>Now that all of the data tables have been reformatted, we can read them in and merge them into a single file. We use the function <code>rbind.fill</code> here to merge the files together since some of these files have age classes that others don’t. The <code>rbind.fill</code> function adds in all columns that exist, filling in the columns that don’t have values for a particular stock with <code>NA</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">readmerge &lt;-<span class="st"> </span><span class="cf">function</span>(path1){
    files &lt;-<span class="st"> </span><span class="kw">dir</span>(path1, <span class="dt">include.dirs =</span> <span class="ot">FALSE</span>)
    files &lt;-<span class="st"> </span>files[ <span class="kw">grepl</span>(<span class="st">&quot;.csv&quot;</span>, files) ]
    a &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind.fill,<span class="kw">lapply</span>(<span class="kw">file.path</span>(path1,files),read.csv, <span class="dt">stringsAsFactors =</span> F))
    <span class="kw">return</span>(a)
}

path1 &lt;-<span class="st"> &#39;data/reformatted/&#39;</span>
b &lt;-<span class="st"> </span><span class="kw">readmerge</span>(path1)</code></pre></div>
<p>Using <code>rbind.fill</code> made the column order a little strange, so we’ll rearrange again.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#rearrange columns</span>
b &lt;-<span class="st"> </span>b[, <span class="kw">c</span>(<span class="st">&#39;Stock.ID&#39;</span>, <span class="st">&#39;Species&#39;</span>, <span class="st">&#39;Stock&#39;</span>,<span class="st">&#39;Region&#39;</span>,<span class="st">&#39;Sub.Region&#39;</span>, <span class="st">&#39;UseFlag&#39;</span>,<span class="st">&#39;BroodYear&#39;</span>,
                <span class="st">&#39;TotalEscapement&#39;</span>,<span class="st">&#39;R0.1&#39;</span>,<span class="st">&#39;R0.2&#39;</span>, <span class="st">&#39;R0.3&#39;</span>,<span class="st">&#39;R0.4&#39;</span>, <span class="st">&#39;R0.5&#39;</span>,
                <span class="st">&#39;R1.1&#39;</span>,<span class="st">&#39;R1.2&#39;</span>,<span class="st">&#39;R1.3&#39;</span>,<span class="st">&#39;R1.4&#39;</span>,<span class="st">&#39;R1.5&#39;</span>, 
                <span class="st">&#39;R2.1&#39;</span>,<span class="st">&#39;R2.2&#39;</span>,<span class="st">&#39;R2.3&#39;</span>,<span class="st">&#39;R2.4&#39;</span>,<span class="st">&#39;R2.5&#39;</span>,
                <span class="st">&#39;R3.1&#39;</span>,<span class="st">&#39;R3.2&#39;</span>,<span class="st">&#39;R3.3&#39;</span>,<span class="st">&#39;R3.4&#39;</span>,
                <span class="st">&#39;R4.1&#39;</span>,<span class="st">&#39;R4.2&#39;</span> ,<span class="st">&#39;R4.3&#39;</span>)]</code></pre></div>
</div>
<div id="quality-assurance" class="section level3">
<h3><span class="header-section-number">2.0.5</span> Quality Assurance</h3>
<p>Now we should do some checks to make sure that the data are up to standards and the reformatting was done correctly.</p>
<p>First, for character columns, check that unique values are as expected.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">charCol &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">lapply</span>(b, class) <span class="op">==</span><span class="st"> &#39;character&#39;</span>) <span class="co">#use lapply and which to find index of columns that are of class &quot;character&quot;</span>

<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(charCol)){
    <span class="kw">print</span>(<span class="kw">colnames</span>(b)[charCol[i]]) <span class="co">#print column name</span>
   <span class="kw">print</span>(<span class="kw">unique</span>(b[, charCol[i]])) <span class="co">#display unique values for that column</span>
}</code></pre></div>
<pre><code>## [1] &quot;Species&quot;
## [1] &quot;Sockeye&quot;
## [1] &quot;Stock&quot;
##  [1] &quot;Ayakulik&quot;         &quot;Bear&quot;             &quot;Black Lake&quot;      
##  [4] &quot;Chignik Lake&quot;     &quot;Chilkoot&quot;         &quot;Coghill&quot;         
##  [7] &quot;Copper&quot;           &quot;Eshamy&quot;           &quot;Frazer&quot;          
## [10] &quot;Goodnews&quot;         &quot;Early Karluk&quot;     &quot;Kasilof&quot;         
## [13] &quot;Kenai&quot;            &quot;Nelson&quot;           &quot;Redoubt&quot;         
## [16] &quot;Speel&quot;            &quot;Togiak&quot;           &quot;E. Upper Station&quot;
## [19] &quot;L. Upper Station&quot; &quot;Washington&quot;      
## [1] &quot;Region&quot;
## [1] &quot;Kodiak&quot;       &quot;AK Peninsula&quot; &quot;Chignik&quot;      &quot;SEAK&quot;        
## [5] &quot;PWS&quot;          &quot;AYK&quot;          &quot;Cook Inlet&quot;   &quot;Bristol Bay&quot; 
## [9] &quot;WA&quot;          
## [1] &quot;Sub.Region&quot;
## [1] &quot;Kodiak&quot;            &quot;AK Peninsula&quot;      &quot;Chignik&quot;          
## [4] &quot;SEAK&quot;              &quot;PWS&quot;               &quot;AYK&quot;              
## [7] &quot;Upper Cook Inlet&quot;  &quot;Bristol Bay North&quot; &quot;WA&quot;</code></pre>
<p>For numeric/integer columns, the <code>summary</code> function gives a nice overview of the range, distribution, and number of <code>NA</code> values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">numCol &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">lapply</span>(b, class) <span class="op">!=</span><span class="st"> &#39;character&#39;</span>) <span class="co">#use lapply and which to find index of columns that are of class &quot;character&quot;</span>
<span class="kw">summary</span>(b[, numCol])</code></pre></div>
<pre><code>##     Stock.ID        UseFlag    BroodYear    TotalEscapement  
##  Min.   :101.0   Min.   :1   Min.   :1922   Min.   :      0  
##  1st Qu.:139.0   1st Qu.:1   1st Qu.:1976   1st Qu.:  57106  
##  Median :145.0   Median :1   Median :1990   Median : 179700  
##  Mean   :144.1   Mean   :1   Mean   :1987   Mean   : 245185  
##  3rd Qu.:152.0   3rd Qu.:1   3rd Qu.:2003   3rd Qu.: 324860  
##  Max.   :164.0   Max.   :1   Max.   :2016   Max.   :2386733  
##                                             NA&#39;s   :15       
##       R0.1              R0.2               R0.3             R0.4        
##  Min.   :   0.00   Min.   :     0.0   Min.   :     0   Min.   :    0.0  
##  1st Qu.:   0.00   1st Qu.:     0.0   1st Qu.:     0   1st Qu.:    0.0  
##  Median :   0.00   Median :     0.0   Median :     0   Median :    0.0  
##  Mean   :  63.13   Mean   :  3611.6   Mean   :  9784   Mean   :  134.8  
##  3rd Qu.:   0.00   3rd Qu.:   233.9   3rd Qu.:  3350   3rd Qu.:    0.0  
##  Max.   :6744.00   Max.   :644017.0   Max.   :800616   Max.   :17036.2  
##  NA&#39;s   :135       NA&#39;s   :128        NA&#39;s   :124      NA&#39;s   :124      
##       R0.5         R1.1              R1.2             R1.3        
##  Min.   :0    Min.   :    0.0   Min.   :     0   Min.   :      0  
##  1st Qu.:0    1st Qu.:    0.0   1st Qu.: 10109   1st Qu.:  16351  
##  Median :0    Median :  281.2   Median : 35497   Median :  81569  
##  Mean   :0    Mean   : 2076.1   Mean   : 92677   Mean   : 323356  
##  3rd Qu.:0    3rd Qu.: 1649.3   3rd Qu.:113439   3rd Qu.: 338788  
##  Max.   :0    Max.   :67475.0   Max.   :854061   Max.   :7661502  
##  NA&#39;s   :59   NA&#39;s   :88        NA&#39;s   :99       NA&#39;s   :111      
##       R1.4               R1.5               R2.1             R2.2       
##  Min.   :     0.0   Min.   :   0.000   Min.   :     0   Min.   :     0  
##  1st Qu.:     0.0   1st Qu.:   0.000   1st Qu.:     0   1st Qu.:  5108  
##  Median :   183.8   Median :   0.000   Median :   262   Median : 36464  
##  Mean   :  3241.3   Mean   :   6.212   Mean   :  5133   Mean   : 94265  
##  3rd Qu.:  1935.0   3rd Qu.:   0.000   3rd Qu.:  5198   3rd Qu.:139990  
##  Max.   :138675.0   Max.   :2374.077   Max.   :104402   Max.   :972290  
##  NA&#39;s   :143        NA&#39;s   :99         NA&#39;s   :130      NA&#39;s   :102     
##       R2.3              R2.4              R2.5              R3.1        
##  Min.   :      0   Min.   :    0.0   Min.   :  0.000   Min.   :    0.0  
##  1st Qu.:   6023   1st Qu.:    0.0   1st Qu.:  0.000   1st Qu.:    0.0  
##  Median :  43629   Median :    0.0   Median :  0.000   Median :    0.0  
##  Mean   : 138813   Mean   :  782.7   Mean   :  1.663   Mean   :  328.1  
##  3rd Qu.: 150893   3rd Qu.:  499.0   3rd Qu.:  0.000   3rd Qu.:    0.0  
##  Max.   :3878906   Max.   :23784.4   Max.   :196.000   Max.   :25325.0  
##  NA&#39;s   :122       NA&#39;s   :155       NA&#39;s   :819       NA&#39;s   :125      
##       R3.2             R3.3              R3.4               R4.1       
##  Min.   :     0   Min.   :    0.0   Min.   :   0.000   Min.   :  0.00  
##  1st Qu.:     0   1st Qu.:    0.0   1st Qu.:   0.000   1st Qu.:  0.00  
##  Median :     0   Median :    0.0   Median :   0.000   Median :  0.00  
##  Mean   :  4460   Mean   : 2667.4   Mean   :   9.181   Mean   : 35.38  
##  3rd Qu.:  1429   3rd Qu.:  532.9   3rd Qu.:   0.000   3rd Qu.:  0.00  
##  Max.   :337905   Max.   :94754.2   Max.   :6745.841   Max.   :809.00  
##  NA&#39;s   :185      NA&#39;s   :164       NA&#39;s   :110        NA&#39;s   :947     
##       R4.2              R4.3        
##  Min.   :   0.00   Min.   :  0.000  
##  1st Qu.:   0.00   1st Qu.:  0.000  
##  Median :   0.00   Median :  0.000  
##  Mean   :  73.73   Mean   :  1.509  
##  3rd Qu.:   0.00   3rd Qu.:  0.000  
##  Max.   :5362.00   Max.   :243.000  
##  NA&#39;s   :772       NA&#39;s   :851</code></pre>
<p>From here, I can go into writing more QA functions or we can go ahead and melt the dataframe. Open to suggestions from you Bryce</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rstudio-and-gitgithub-setup.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-brood-table-integration.Rmd",
"text": "Edit"
},
"download": ["open-science-for-salmon.pdf", "open-science-for-salmon.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
